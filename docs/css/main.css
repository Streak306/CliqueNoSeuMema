:root{
  --maxw: 1400px;
  --gap: 24px;
  --sidew: 380px;

  /* Tema escuro suave */
  --bg:        #14171c;
  --bg-grad-1: #1d222b;
  --bg-grad-2: #171b22;
  --fg:        #e7ebf0;
  --muted:     #a3adba;

  --card-bg:   #1b2029;
  --panel-bg:  #161b22;
  --border:    #2a303a;

  --pill-bg:   #181d25;
  --stage-border: #2d3441;
  --accent:    #60a5fa;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:system-ui; line-height:1.45; color:var(--fg);
  background:
    radial-gradient(900px 500px at 10% -10%, var(--bg-grad-1) 0%, transparent 40%),
    radial-gradient(900px 500px at 110% -10%, var(--bg-grad-2) 0%, transparent 35%),
    linear-gradient(180deg, #13171c 0%, var(--bg) 100%);
}
.wrap{max-width:var(--maxw);margin:0 auto;padding:28px;position:relative;}

/* Topo */
header{ text-align:center; position:sticky; top:0; z-index:10; padding-bottom:10px; backdrop-filter:saturate(140%) blur(4px) }
h1{ margin:6px 0 12px 0; font-size:2.6rem; letter-spacing:.3px; }
.stats{ display:flex;gap:12px;flex-wrap:wrap;justify-content:center }
.pill{
  display:inline-block;padding:8px 14px;border:1px solid var(--border);
  background:var(--pill-bg); border-radius:999px; color:var(--fg)
}
#pts{font-size:1.6rem;font-variant-numeric:tabular-nums}

/* simple button style (missing before) */
.btn{
  padding:10px 14px;border:1px solid var(--border);border-radius:12px;
  background:#171c24;color:var(--fg);cursor:pointer;
  transition:filter .15s ease, transform .08s ease;
  font-weight:600;
}
.btn:hover{ filter:brightness(1.06); }
.btn:active{ transform:translateY(1px) }

/* Grid principal */
.grid{
  display:grid; grid-template-columns: var(--sidew) 1fr var(--sidew);
  gap: var(--gap); align-items:start; margin-top: 20px;
}
.card{ border:1px solid var(--border);border-radius:16px;padding:16px;background:var(--card-bg); }
.card p{ color:var(--muted); }
.muted{ color:var(--muted); }

/* Upgrades (aba esquerda) */
.upgrades-card{ display:flex; flex-direction:column; gap:16px; min-height: min(76vh, 820px); }
.upgrades-title{ margin:6px 0 0; font-size:1.35rem; letter-spacing:.4px; }
.upgrades-sub{ margin:0; font-size:.92rem; }
.upgrade-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(72px,1fr));
  gap:12px;
}
.tooltip-host{ position:relative; }

.upgrade-tile{
  position:relative;
  width:100%;
  aspect-ratio:1;
  border:1px solid var(--border);
  border-radius:14px;
  background:var(--panel-bg);
  padding:0;
  overflow:visible;
  cursor:pointer;
  transition:transform .12s ease, box-shadow .15s ease, border-color .15s ease, filter .15s ease;
  display:block;
  font:inherit;
  color:inherit;
}
.upgrade-tile img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  border-radius:inherit;
}
.upgrade-tile.available{
  border-color:rgba(96,165,250,.65);
  box-shadow:0 10px 26px rgba(96,165,250,.26);
  background:linear-gradient(180deg, rgba(96,165,250,.22) 0%, rgba(23,27,34,1) 60%);
  filter:saturate(1.05) brightness(1.02);
}
.upgrade-tile.available:hover{ transform:translateY(-3px); box-shadow:0 14px 30px rgba(59,130,246,.32); }
.upgrade-tile.locked{
  filter:grayscale(.85) brightness(.72);
  border-color:rgba(32,38,48,.9);
  background:#12161d;
  opacity:.8;
}
.upgrade-tile.purchased{
  cursor:default;
  border-color:rgba(96,165,250,.55);
  box-shadow:0 12px 28px rgba(96,165,250,.24);
  filter:saturate(1.08) brightness(1.05);
}
.upgrade-tile:disabled{ cursor:default; }
.upgrade-tile:focus-visible{ outline:2px solid var(--accent); outline-offset:3px; }
.upgrade-check{
  position:absolute;
  right:6px;
  top:6px;
  background:rgba(15,23,42,.85);
  color:var(--accent);
  border-radius:999px;
  padding:2px 6px;
  font-size:12px;
  font-weight:700;
  display:none;
  align-items:center;
  justify-content:center;
}
.upgrade-tile.purchased .upgrade-check{ display:flex; }
.upgrade-tile.buzz{ animation:buzz .15s linear 2; }

/* make the shop card match stage height so items don't look "outside" */
.shop-card{ min-height: min(76vh, 820px); display:flex; flex-direction:column; }

/* Modal de configurações */
.settings-btn{ display:flex; align-items:center; gap:8px; }
.settings-btn svg{ width:18px; height:18px; }

.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(10,12,18,.78);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:40;
}
.modal-overlay.open{ display:flex; }
.modal-card{
  width:min(760px, 92vw);
  max-height:88vh;
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:20px;
  box-shadow:0 24px 60px rgba(0,0,0,.45);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:20px 24px 12px 24px;
  border-bottom:1px solid var(--border);
}
.modal-header h2{ margin:0; font-size:1.5rem; }
.modal-close{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:1.6rem;
  line-height:1;
  padding:4px 8px;
}
.modal-tabs{
  display:flex;
  gap:8px;
  padding:14px 24px;
  border-bottom:1px solid var(--border);
}
.modal-tab{
  border:none;
  border-radius:999px;
  padding:8px 18px;
  background:var(--pill-bg);
  color:var(--muted);
  cursor:pointer;
  font-weight:600;
  transition:filter .15s ease, background .15s ease, color .15s ease;
}
.modal-tab.active{
  background:rgba(96,165,250,.16);
  color:var(--fg);
  box-shadow:0 0 0 1px rgba(96,165,250,.4);
}
.modal-content{
  padding:24px;
  overflow:auto;
  flex:1;
}
.modal-panel{ display:none; }
.modal-panel.active{ display:block; }

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:16px;
  margin-bottom:22px;
}
.stat-card{
  background:var(--panel-bg);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px 16px;
}
.stat-card span{ display:block; font-size:.85rem; color:var(--muted); margin-bottom:6px; }
.stat-card strong{ font-size:1.1rem; letter-spacing:.3px; }

.collection-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px;
}
.collection-count{ color:var(--muted); font-weight:600; }

.collection-section{
  display:flex;
  flex-wrap:wrap;
  gap:16px;
}
.collection-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(88px,1fr));
  gap:14px;
  flex:1 1 300px;
}
.collection-slot{
  position:relative;
  aspect-ratio:1;
  border:1px dashed var(--border);
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--panel-bg);
  overflow:hidden;
}
.collection-slot img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.slot-placeholder{
  font-size:2rem;
  color:var(--muted);
  opacity:.65;
}
.collection-slot.owned{ border-style:solid; border-color:rgba(96,165,250,.55); box-shadow:0 10px 26px rgba(96,165,250,.24); }
.collection-slot.selected{
  border-style:solid;
  border-color:rgba(96,165,250,.75);
  box-shadow:0 0 0 2px rgba(96,165,250,.35), 0 14px 32px rgba(96,165,250,.30);
}
.collection-slot.owned .slot-placeholder{ display:none; }
.collection-slot .slot-name{
  position:absolute;
  left:8px;
  right:8px;
  bottom:8px;
  background:rgba(13,17,23,.78);
  border-radius:12px;
  padding:4px 6px;
  font-size:.7rem;
  text-align:center;
  color:var(--fg);
}

.collection-details{
  flex:1 1 240px;
  min-width:240px;
  border:1px solid var(--border);
  border-radius:16px;
  background:var(--panel-bg);
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.collection-details h4{
  margin:0;
  font-size:1.1rem;
}
.collection-details p{
  margin:0;
  color:var(--muted);
  font-size:.9rem;
  line-height:1.4;
}
.collection-detail-meta{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.collection-detail-meta .label{
  display:block;
  font-size:.75rem;
  letter-spacing:.4px;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:4px;
}
.collection-detail-meta strong{
  font-size:.95rem;
}
.collection-detail-meta ul{
  margin:0;
  padding-left:18px;
  color:var(--muted);
  font-size:.9rem;
  line-height:1.4;
}
.collection-detail-meta ul li{ margin-bottom:4px; }
.collection-detail-meta ul li:last-child{ margin-bottom:0; }
.collection-detail-ownership{
  margin-top:auto;
  font-size:.8rem;
  color:var(--muted);
}
@media (max-width:720px){
  .collection-details{ flex-basis:100%; }
}

.achievements-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px;
}
.achievements-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(220px,1fr));
  gap:14px;
}
.achievement-card{
  background:var(--panel-bg);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px 16px;
  min-height:96px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:6px;
  position:relative;
}
.achievement-card::before{
  content:'';
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  transition:opacity .2s ease;
  opacity:0;
  box-shadow:0 12px 28px rgba(96,165,250,.18);
}
.achievement-card.unlocked::before{ opacity:1; }
.achievement-card.locked{
  opacity:.68;
  filter:grayscale(.78);
}
.achievement-name{
  margin:0;
  font-weight:700;
  font-size:1rem;
}
.achievement-desc{
  margin:0;
  color:var(--muted);
  font-size:.9rem;
}

.achievement-toast{
  position:fixed;
  left:50%;
  bottom:18px;
  transform:translate(-50%, 22px);
  background:rgba(15,23,42,.92);
  color:var(--fg);
  border:1px solid rgba(96,165,250,.55);
  border-radius:999px;
  padding:10px 20px;
  font-weight:700;
  font-size:.95rem;
  box-shadow:0 18px 38px rgba(15,23,42,.45);
  opacity:0;
  pointer-events:none;
  transition:opacity .4s ease, transform .4s ease;
  z-index:35;
  text-align:center;
}
.achievement-toast.show{
  opacity:1;
  transform:translate(-50%, 0);
}

#purchaseToast{
  position:fixed;
  top:18px;
  left:50%;
  transform:translate(-50%, -16px);
  background:rgba(10,14,22,.94);
  color:#e2e8f0;
  border:1px solid rgba(148,163,184,.45);
  border-radius:10px;
  padding:10px 22px;
  font-family:'Fira Code', 'IBM Plex Mono', 'SFMono-Regular', Menlo, monospace;
  font-size:.85rem;
  letter-spacing:.12em;
  text-transform:uppercase;
  text-shadow:0 0 6px rgba(148,163,184,.25);
  box-shadow:0 18px 40px rgba(2,6,14,.4);
  opacity:0;
  pointer-events:none;
  transition:opacity .22s ease, transform .22s ease;
  z-index:48;
  animation:purchaseToastGlitch 1.1s steps(3) infinite;
}
#purchaseToast.show{
  opacity:1;
  transform:translate(-50%, 0);
}
#purchaseToast.toast-final{
  background:linear-gradient(135deg, rgba(220,38,38,.92), rgba(249,115,22,.88));
  border-color:rgba(248,250,252,.4);
  color:#fef2f2;
  box-shadow:0 24px 48px rgba(220,38,38,.45);
}
@keyframes purchaseToastGlitch{
  0%,100%{ text-shadow:0 0 6px rgba(148,163,184,.24); opacity:1; }
  40%{ text-shadow:-1px 0 rgba(96,165,250,.28), 1px 0 rgba(14,165,233,.16); }
  70%{ text-shadow:1px 0 rgba(94,234,212,.22), -1px 0 rgba(79,70,229,.18); }
}

body.glitch-prelude{
  cursor:wait;
}
body.glitch-prelude .click-img,
body.glitch-prelude .shop tbody tr,
body.glitch-prelude .btn,
body.glitch-prelude .upgrade-tile{
  pointer-events:none;
  filter:saturate(.82);
}
@keyframes glitchHue{
  0%{ filter:hue-rotate(-6deg) contrast(1.12) brightness(1.05); }
  100%{ filter:hue-rotate(6deg) contrast(1.22) brightness(1.08); }
}
.world-end-overlay{
  position:fixed;
  inset:0;
  background:#000;
  color:#f8fafc;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:120;
  padding:24px;
}
.world-end-overlay.open{
  display:flex;
}
.world-end-overlay:focus{
  outline:none;
}
.world-end-overlay-content{
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:24px;
}
.world-end-overlay h2{
  margin:0 0 24px;
  font-size:clamp(2.2rem, 5vw, 3.4rem);
  letter-spacing:.15em;
  text-transform:uppercase;
}
.world-end-overlay button{
  padding:12px 28px;
  border-radius:999px;
  border:1px solid rgba(248,250,252,.6);
  background:rgba(15,23,42,.85);
  color:inherit;
  font-weight:700;
  letter-spacing:.08em;
  text-transform:uppercase;
  cursor:pointer;
  transition:transform .12s ease, background .12s ease, box-shadow .12s ease;
}
.world-end-overlay button:hover{
  background:rgba(30,41,59,.92);
  box-shadow:0 0 0 2px rgba(96,165,250,.3);
}
.world-end-overlay button:focus-visible{
  outline:2px solid #60a5fa;
  outline-offset:4px;
}
body.world-end{
  overflow:hidden;
}
body.world-end .wrap,
body.world-end header,
body.world-end main,
body.world-end .modal-overlay,
body.world-end #purchaseToast,
body.world-end #saveToast,
body.world-end #achievementToast{
  pointer-events:none;
}

/* Palco */
.stage{
  display:grid; place-items:center; min-height: min(76vh, 820px);
  border:1px dashed var(--stage-border); border-radius:16px; background:var(--panel-bg);
}
.click-img{
  width:clamp(260px, 42vw, 420px); height:clamp(260px, 42vw, 420px); object-fit:cover;
  border:1px solid var(--border);border-radius:18px;cursor:pointer;
  box-shadow:0 10px 28px rgba(0,0,0,.38);
  transition:transform .06s ease, filter .15s ease; user-select:none;
}
.click-img:hover{ filter:brightness(1.06); }
.click-img:active{ transform:translateY(1px) scale(.98); }

.glitch-jitter{
  filter:contrast(.98) saturate(.94) blur(.3px);
}
.glitch-shift{
  filter:contrast(.94) saturate(.9);
}
.wrap.glitch-scanlines::after{
  content:"";
  position:absolute;
  inset:0;
  background:repeating-linear-gradient(0deg, rgba(148,163,184,.05) 0 2px, rgba(8,10,18,0) 2px 6px);
  mix-blend-mode:screen;
  opacity:.05;
  pointer-events:none;
}

/* Indicador de save */
.save-toast{
  position:fixed; right:16px; bottom:16px;
  background:#0b1f47; color:var(--accent);
  border:1px solid #1d4ed8; border-radius:999px;
  padding:8px 12px; font-weight:700; font-size:14px;
  box-shadow:0 4px 16px rgba(0,0,0,.35);
  opacity:0; transform:translateY(8px); pointer-events:none;
  transition:opacity .6s ease, transform .6s ease;
}
.save-toast.show{ opacity:1; transform:translateY(0); }

/* LOJA – tabela clicável */
.shop-title{margin:10px 0 12px;font-weight:800; letter-spacing:.2px;}

table.shop{width:100%; border-collapse:separate; border-spacing:0 12px; table-layout:fixed}
.shop thead th{font-size:12px; text-align:left; opacity:.75; padding:0 10px}
.shop tbody tr{
  background:var(--panel-bg); border:1px solid var(--border); border-radius:12px;
  transition:background .12s ease, transform .06s ease, box-shadow .12s ease, filter .12s ease;
}
.shop tbody td{padding:14px 12px; vertical-align:middle; overflow:hidden}
.shop .name{font-weight:700}
.shop .limit{opacity:.85}
.shop .status{font-size:12px; opacity:.85; margin-top:6px}

/* linha clicável */
.shop tr.clickable{ cursor:pointer; }
.shop tr.clickable:hover{ filter:brightness(1.08); box-shadow:0 8px 22px rgba(0,0,0,.28); }
.shop tr.clickable:active{ transform:scale(.992); }
/* limite atingido */
.shop tr.max{ opacity:.6; cursor:not-allowed; }

/* linha com grana suficiente */
.shop tr.afford{
  box-shadow:0 0 0 1px rgba(16,185,129,.30), 0 6px 18px rgba(0,0,0,.25);
}
.shop tr.afford:hover{
  filter:brightness(1.08);
}
/* owned/limit estilo grande (novo) */
.owned-limit{ font-weight:800; font-size:1.05rem; letter-spacing:.6px; color:var(--fg); }
.owned-limit .owned{ color:var(--fg); opacity:0.95; margin-right:6px; }
.owned-limit .sep{ opacity:0.6; margin: 0 6px; color:var(--muted) }

/* linha travada (não aparece até desbloquear) */
.shop tr.locked{ display:none; }

/* “faltam pontos” + buzz */
.need{ font-size:12px; color:#93c5fd; opacity:.95; margin-top:4px }
@keyframes buzz{ 0%,100%{transform:translateX(0)} 20%{transform:translateX(-2px)} 40%{transform:translateX(2px)} 60%{transform:translateX(-1px)} 80%{transform:translateX(1px)} }
.buzz{ animation:buzz .15s linear 2 }

@keyframes flashG{ from{box-shadow:0 0 0 2px rgba(16,185,129,.55)} to{box-shadow:0 0 0 10px rgba(16,185,129,0)} }
.flashG{ animation:flashG .42s ease-out 1; }

/* evita highlight azul no mobile e seleção de texto */
.shop tbody tr{ -webkit-tap-highlight-color:transparent; user-select:none; }

/* Responsivo */
@media (max-width: 980px){
  :root{ --sidew: 1fr }
  .grid{ grid-template-columns: 1fr; }
  .stage{ min-height: 54vh; }
  .shop-card{ min-height: auto; }
  .upgrades-card{ min-height: auto; }
}
