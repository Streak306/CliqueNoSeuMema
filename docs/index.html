<!doctype html>
<meta charset="utf-8">
<title>Clique no seu Mema</title>
<style>
  :root{
    --maxw: 1400px;
    --gap: 24px;
    --sidew: 340px;

    /* Tema escuro suave */
    --bg:        #14171c;
    --bg-grad-1: #1d222b;
    --bg-grad-2: #171b22;
    --fg:        #e7ebf0;
    --muted:     #a3adba;

    --card-bg:   #1b2029;
    --panel-bg:  #161b22;
    --border:    #2a303a;

    --btn-bg:    #171c24;
    --btn-hover: #1b212a;

    --pill-bg:   #181d25;

    --stage-border: #2d3441;
    --accent:    #60a5fa;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui;
    color:var(--fg);
    background:
      radial-gradient(900px 500px at 10% -10%, var(--bg-grad-1) 0%, transparent 40%),
      radial-gradient(900px 500px at 110% -10%, var(--bg-grad-2) 0%, transparent 35%),
      linear-gradient(180deg, #13171c 0%, var(--bg) 100%);
    line-height:1.45;
  }

  .wrap{max-width:var(--maxw);margin:0 auto;padding:28px}

  /* Topo */
  header{ text-align:center; position:sticky; top:0; z-index:10; padding-bottom:10px; backdrop-filter:saturate(140%) blur(4px) }
  h1{
    margin:6px 0 12px 0;
    font-size:2.6rem;
    letter-spacing:.3px;
  }
  .stats{
    display:flex;gap:12px;flex-wrap:wrap;justify-content:center
  }
  .pill{
    display:inline-block;padding:8px 14px;border:1px solid var(--border);
    background:var(--pill-bg); border-radius:999px; color:var(--fg)
  }
  #pts{font-size:1.6rem;font-variant-numeric:tabular-nums}

  /* Grid principal: esquerda | centro | direita */
  .grid{
    display:grid;
    grid-template-columns: var(--sidew) 1fr var(--sidew);
    gap: var(--gap);
    align-items:start;
    margin-top: 20px;
  }
  .card{
    border:1px solid var(--border);border-radius:16px;padding:16px;
    background:var(--card-bg);
  }
  .card p{ color:var(--muted); }

  /* Palco central com Mema */
  .stage{
    display:grid; place-items:center;
    min-height: min(76vh, 820px);
    border:1px dashed var(--stage-border); border-radius:16px;
    background:var(--panel-bg);
  }
  .click-img{
    width:clamp(260px, 42vw, 420px);
    height:clamp(260px, 42vw, 420px);
    object-fit:cover;
    border:1px solid var(--border);border-radius:18px;cursor:pointer;
    box-shadow:0 10px 28px rgba(0,0,0,.38);
    transition:transform .06s ease, filter .15s ease;
    user-select:none;
  }
  .click-img:hover{ filter:brightness(1.06); }
  .click-img:active{ transform:translateY(1px) scale(.98); }

  /* Botões */
  .btn{
    padding:12px 14px;border:1px solid var(--border);border-radius:12px;
    cursor:pointer;background:var(--btn-bg);color:var(--fg);width:100%;
    transition:background .15s ease, filter .15s ease, transform .08s ease;
  }
  .btn:hover{ background:var(--btn-hover); filter:brightness(1.03); }
  .btn:active{ transform:translateY(1px) }
  .btn[disabled]{ opacity:.5; cursor:not-allowed }

  .btn-danger{border-color:#3a2224;background:#24181a;color:#ef4444}
  .btn-danger:hover{background:#2a1b1e}

  /* Indicador de save (canto inferior) */
  .save-toast{
    position:fixed; right:16px; bottom:16px;
    background:#0b1f47; color:var(--accent);
    border:1px solid #1d4ed8; border-radius:999px;
    padding:8px 12px; font-weight:700; font-size:14px;
    box-shadow:0 4px 16px rgba(0,0,0,.35);
    opacity:0; transform:translateY(8px);
    pointer-events:none;
    transition:opacity .6s ease, transform .6s ease;
  }
  .save-toast.show{ opacity:1; transform:translateY(0); }

  /* LOJA – tabela linda */
  .shop-title{margin:10px 0 12px;font-weight:800; letter-spacing:.2px}
  table.shop{width:100%; border-collapse:separate; border-spacing:0 12px}
  .shop thead th{font-size:12px; text-align:left; opacity:.75; padding:0 10px}
  .shop tbody tr{background:var(--panel-bg); border:1px solid var(--border); border-radius:12px}
  .shop tbody td{padding:12px 10px; vertical-align:middle}
  .shop .name{font-weight:700}
  .shop .limit{opacity:.85}
  .shop .buy .btn{padding:10px 12px}
  .muted{opacity:.75}

  .row{
    border:1px solid var(--border); border-radius:12px; padding:12px; background:var(--panel-bg);
  }

  /* feedback “faltam pontos” */
  .need{ font-size:12px; color:#93c5fd; opacity:.95; margin-top:6px }

  /* micro animação de atenção */
  @keyframes buzz{ 0%,100%{transform:translateX(0)} 20%{transform:translateX(-2px)} 40%{transform:translateX(2px)} 60%{transform:translateX(-1px)} 80%{transform:translateX(1px)}}
  .buzz{ animation:buzz .15s linear 2 }
  
  /* Responsivo: empilha em telas pequenas */
  @media (max-width: 980px){
    :root{ --sidew: 1fr }
    .grid{ grid-template-columns: 1fr; }
    .stage{ min-height: 54vh; }
  }
</style>

<div class="wrap">
  <!-- TOPO -->
  <header>
    <h1>Clique no seu Mema</h1>
    <div class="stats">
      <span class="pill">Pontos: <b id="pts">0</b></span>
      <span class="pill">Por clique: <b id="pc">1</b></span>
      <span class="pill">Auto/s: <b id="cps">0</b></span>
      <button class="btn btn-danger" id="deleteSave" style="max-width:220px">Apagar save</button>
    </div>
  </header>

  <!-- GRID -->
  <main class="grid">
    <!-- ESQUERDA: reservado -->
    <aside class="card">
      <h3 style="margin:6px 0 10px">Aba esquerda</h3>
      <p style="margin:0;opacity:.85">Espaço reservado pra um modo/aba futura.</p>
    </aside>

    <!-- CENTRO: Mema grande -->
    <section class="stage">
      <img id="click" class="click-img" src="mema_back.png" alt="Clique no seu Mema">
    </section>

    <!-- DIREITA: Loja -->
    <aside class="card">
      <div class="shop-title">Loja</div>
      <table class="shop">
        <thead>
          <tr>
            <th>Item</th>
            <th>+Auto/s</th>
            <th>Possuído</th>
            <th>Limite</th>
            <th>Custo</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="shopBody"></tbody>
      </table>
      <p class="muted" style="margin-top:8px">Os preços sobem a cada compra. O botão só trava quando chegar no limite.</p>
    </aside>
  </main>
</div>

<!-- Indicador de save -->
<div id="saveToast" class="save-toast">salvo</div>

<script>
/* --- estado do jogo --- */
let pts=0, clickPow=1, auto=0;

/* --- imagens do Mema --- */
const IMG_BACK  = 'mema_back.png';
const IMG_FRONT = 'mema_front.png';
const FRONT_TIME_MS = 400;
let faceTimer = null;

/* helpers */
const el=(id)=>document.getElementById(id);
const fmt=(n)=>Math.round(n);

/* SAVE/LOAD */
let shopState = null; // definido após catálogo
function save(showToast=false){
  localStorage.setItem('mcw', JSON.stringify({pts,clickPow,auto, shopState}));
  if(showToast) flashSave();
}
function load(){ try{
  const d = JSON.parse(localStorage.getItem('mcw')||'{}');
  pts=d.pts??0; clickPow=d.clickPow??1; auto=d.auto??0;
  if(d.shopState) shopState = {...makeInitialShopState(), ...d.shopState};
} catch(e){} }

/* UI */
function render(){
  el('pts').textContent=fmt(pts);
  el('pc').textContent=clickPow;
  el('cps').textContent=auto.toFixed(2);
  renderShop();
}

/* feedback imagem */
function showFront(){
  const img = el('click');
  img.src = IMG_FRONT;
  if (faceTimer) clearTimeout(faceTimer);
  faceTimer = setTimeout(()=>{ img.src = IMG_BACK; }, FRONT_TIME_MS);
}

/* reset */
function resetState(){
  pts=0; clickPow=1; auto=0;
  shopState = makeInitialShopState();
}
function deleteSave(){
  const ok = confirm('Apagar seu save? Esta ação não pode ser desfeita.');
  if(!ok) return;
  localStorage.removeItem('mcw');
  resetState(); render();
}

/* loop de pontos automáticos */
function loop(){
  let last=performance.now();
  function tick(){
    const now=performance.now(), dt=(now-last)/1000; last=now;
    pts+=auto*dt; render();
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

/* auto-save + toast */
let saveTimer = null;
function startAutoSave(){
  if(saveTimer) clearInterval(saveTimer);
  saveTimer = setInterval(()=> save(true), 5000);
}
let toastTimer=null;
function flashSave(){
  const t = el('saveToast');
  t.textContent = 'salvo';
  t.classList.add('show');
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.classList.remove('show'), 1400);
}

/* preload imagens */
(new Image()).src = IMG_BACK;
(new Image()).src = IMG_FRONT;

/* ===================== LOJA ===================== */
/* Catálogo + limites + curva de preço */
const SHOP = [
  {id:'dedo',       name:'Dedo',       cps:0.10, base:15,    mul:1.15, limit:50},
  {id:'roupa',      name:'Roupa',      cps:0.50, base:80,    mul:1.15, limit:20},
  {id:'agua',       name:'Água',       cps:1.00, base:150,   mul:1.16, limit:20},
  {id:'plantacao',  name:'Plantação',  cps:2.50, base:450,   mul:1.17, limit:12},
  {id:'alojamento', name:'Alojamento', cps:5.00, base:900,   mul:1.18, limit:8},
  {id:'casa',       name:'Casa',       cps:10.0, base:1800,  mul:1.19, limit:5},
  {id:'xbox',       name:'Xbox',       cps:15.0, base:3200,  mul:1.20, limit:3},
  {id:'computador', name:'Computador', cps:25.0, base:6000,  mul:1.21, limit:3},
  {id:'microfone',  name:'Microfone',  cps:40.0, base:10000, mul:1.22, limit:2},
  {id:'namorada',   name:'Namorada',   cps:100.0,base:50000, mul:1.30, limit:1}
];

function makeInitialShopState(){
  const s={};
  SHOP.forEach(it=> s[it.id] = {owned:0, cost:it.base});
  return s;
}
if(!shopState) shopState = makeInitialShopState();

function renderShop(){
  const body = document.getElementById('shopBody');
  if(!body) return;
  body.innerHTML='';
  SHOP.forEach(it=>{
    const st = shopState[it.id];
    const atLimit = st.owned >= it.limit;
    const price = Math.ceil(st.cost);
    const missing = Math.max(0, price - pts);

    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td class="name">${it.name}</td>
      <td>+${it.cps.toFixed(2)}</td>
      <td>${st.owned}</td>
      <td class="limit">${it.limit}</td>
      <td>${price}</td>
      <td class="buy">
        <div>
          <button class="btn" id="buy-${it.id}" ${atLimit ? 'disabled' : ''}>
            ${atLimit ? 'MAX' : `Comprar`}
          </button>
          ${(!atLimit && missing>0) ? `<div class="need">Faltam ${missing} pts</div>` : ''}
        </div>
      </td>
    `;

    body.appendChild(tr);

    const btn = tr.querySelector(`#buy-${it.id}`);
    btn.onclick = ()=>{
      buyItem(it.id, btn);
    };
  });
}

function buyItem(id, btnEl){
  const it = SHOP.find(x=>x.id===id); if(!it) return;
  const st = shopState[id];
  const price = Math.ceil(st.cost);

  if(st.owned >= it.limit){
    btnEl.disabled = true;
    btnEl.textContent = 'MAX';
    return;
  }

  if(pts < price){
    // feedback rápido (sem travar o botão)
    btnEl.classList.add('buzz');
    const needEl = btnEl.parentElement.querySelector('.need');
    if(needEl){
      needEl.textContent = `Faltam ${price - pts} pts`;
    }else{
      const div = document.createElement('div');
      div.className = 'need';
      div.textContent = `Faltam ${price - pts} pts`;
      btnEl.parentElement.appendChild(div);
    }
    setTimeout(()=> btnEl.classList.remove('buzz'), 320);
    return;
  }

  // compra
  pts -= price;
  st.owned += 1;
  auto += it.cps;

  if(st.owned < it.limit){
    st.cost = Math.ceil(st.cost * it.mul);
  }else{
    btnEl.disabled = true;
    btnEl.textContent = 'MAX';
  }

  render(); save(true);
}

/* init */
load(); render(); loop(); startAutoSave();

/* clique na imagem (para juntar pontos) */
el('click').onclick=()=>{ pts+=clickPow; render(); save(); showFront(); };

/* ações */
el('deleteSave').onclick=deleteSave;
</script>
